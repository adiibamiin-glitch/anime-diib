<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ANIME DIIB</title>
    <meta name="description" content="ANIME DIIB ØªØ·Ø¨ÙŠÙ‚ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø£Ù†Ù…ÙŠ: ÙˆØ§Ø¬Ù‡Ø© Ø®ÙÙŠÙØ©ØŒ Ù…ÙŠØ²Ø§Øª Ø°ÙƒÙŠ. Ø­Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¨Ø§Ø´Ø±Ø©." />
    <meta property="og:title" content="ANIME DIIB" />
    <meta property="og:description" content="ØªØ·Ø¨ÙŠÙ‚ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø§Ù†Ù…ÙŠ â€” Ø­Ù…Ù‘Ù„Ù‡ Ø§Ù„Ø¢Ù†." />
    <meta property="og:type" content="website" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="favicon.png" />
    <meta name="theme-color" content="#071021" />
    <link rel="manifest" href="manifest.json" />
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "SoftwareApplication",
        "name": "ANIME DIIB",
        "url": "./",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Android",
        "offers": {"@type": "Offer","price":"0","url":"https://1drv.ms/u/c/846dc043d4c4fd3b/IQDAFJufykDESbGP7xjBJNlnAXlzYCYA_Za3UUjS6Clcf7A"}
    }
    </script>
</head>
<body>
    <header class="site-header" role="banner">
        <div class="container header-inner">
                <div class="brand" aria-hidden="false">
                <img src="logo.png" alt="Ø´Ø¹Ø§Ø± ANIME DIIB" class="logo" width="56" height="56" />
                <div>
                    <strong class="app-name gradient-text">ANIME DIIB</strong>
                    <div class="tag">ØªØ·Ø¨ÙŠÙ‚ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ â€” Ù…Ø³Ù„Ø³Ù„Ø§Øª ÙˆØ§ÙÙ„Ø§Ù… Ø§Ù†Ù…ÙŠ</div>
                </div>
            </div>
            <!-- Compact aggregated rating displayed in header (read-only) -->
            <div class="header-rating" id="header-rating" aria-hidden="false" title="Ù…ØªÙˆØ³Ø· ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">
                <div class="hdr-rating-average" id="hdr-rating-average">0.0</div>
                <div class="hdr-rating-stars" id="hdr-rating-stars">â˜†â˜†â˜†â˜†â˜†</div>
            </div>
            <nav class="nav" role="navigation" aria-label="Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                <a class="nav-link" href="contact.html">ØªÙˆØ§ØµÙ„</a>
                <button id="download-nav" class="btn btn-ghost" data-href="https://1drv.ms/u/c/846dc043d4c4fd3b/IQDAFJufykDESbGP7xjBJNlnAXlzYCYA_Za3UUjS6Clcf7A" aria-label="ØªØ­Ù…ÙŠÙ„ ANIME DIIB Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø±">ØªØ­Ù…ÙŠÙ„</button>
                <!-- Header compact progress (hidden until active) -->
                <div id="header-download-progress" class="header-progress-wrap visually-hidden" aria-hidden="true">
                    <div class="header-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width:0%"></div>
                    <div class="header-progress-label">0%</div>
                </div>
            </nav>
        </div>
    </header>

    <main role="main">
        <section class="hero">
            <div class="container hero-grid">
                <div class="hero-body">
                      <h1 class="gradient-text">ANIME DIIB</h1>
                    <p class="lead">Ù‡Ùˆ ØªØ·Ø¨ÙŠÙ‚ ØªÙˆØ§ØµÙ„ ÙˆÙ…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø§Ù†Ù…ÙŠ â€” ØªØ¬Ø±Ø¨Ø© Ù…Ø«ÙŠØ±Ø©Ù‘ØŒÙ…Ø¹ Ù…ÙØ§Ø¬Ø£Øª Ø§Ø®Ø±Ù‰ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ .</p>
                    <div class="hero-ctas">
                        <button id="download" class="btn btn-primary" data-href="https://1drv.ms/u/c/846dc043d4c4fd3b/IQDAFJufykDESbGP7xjBJNlnAXlzYCYA_Za3UUjS6Clcf7A" aria-label="ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ ANIME DIIB Ø§Ù„Ø¢Ù†">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>
                        <!-- send-link removed per request -->
                        <button id="pwa-install" class="btn btn-outline visually-hidden" aria-hidden="true">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
                        <a class="btn btn-outline" href="#features" aria-label="Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚">Ø§Ù„Ù…Ø²Ø§ÙŠØ§</a>
                                                <div id="not-android" class="visually-hidden" aria-hidden="true" style="margin-top:8px;color:var(--muted)">Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø®ØµÙ‘Øµ Ù„Ø£Ø¬Ù‡Ø²Ø© Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ â€” Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„.</div>
                                                <div id="download-progress" class="progress-wrap visually-hidden" aria-hidden="true">
                                                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width:0%"></div>
                                                    <div class="progress-label">0%</div>
                                                </div>
                    </div>
                                        <ul class="quick-features">
                                                <li>Ø®ÙÙŠÙ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Ø²</li>
                                                <li>Ø¯Ø¹Ù… RTL ÙˆÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©</li>
                                                <li>ØªØ­Ø¯ÙŠØ«Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</li>
                                                <li>ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ </li>
                                        </ul>

                                        <!-- Rating block (fixed position under hero) -->
                                        <div id="rating-block" class="rating-block">
                                            <div class="rating-display">
                                                <div class="rating-average" id="rating-average">0.0</div>
                                                <div class="rating-stars" id="rating-stars">â˜…â˜…â˜…â˜…â˜…</div>
                                            </div>
                                            <div class="rating-actions">
                                                <div class="rating-prompt">Ù‚ÙŠÙ‘Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</div>
                                                <div class="rating-input" id="rating-input">
                                                    <button class="star-btn" data-value="1" aria-label="1 Ù†Ø¬Ù…Ø©">â˜†</button>
                                                    <button class="star-btn" data-value="2" aria-label="2 Ù†Ø¬Ù…ØªÙŠÙ†">â˜†</button>
                                                    <button class="star-btn" data-value="3" aria-label="3 Ù†Ø¬ÙˆÙ…">â˜†</button>
                                                    <button class="star-btn" data-value="4" aria-label="4 Ù†Ø¬ÙˆÙ…">â˜†</button>
                                                    <button class="star-btn" data-value="5" aria-label="5 Ù†Ø¬ÙˆÙ…">â˜†</button>
                                                </div>
                                                <div class="rating-summary small muted" id="rating-count">Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯</div>
                                            </div>
                                        </div>
                </div>
                <div class="hero-media">
                    <img src="screen1.jpg" alt="Ø§Ù…Ø«Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†Ù…ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚  ANIME DIIB" loading="eager" width="360" height="720" />
                </div>
            </div>
        </section>

        <section id="features" class="container features" aria-labelledby="features-title">
            <h2 id="features-title">Ù…Ø²Ø§ÙŠØ§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
            <div class="features-grid">
                <article class="feature">
                    <div class="icon">ğŸ“º</div>
                    <h3>ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¶ Ø£Ù†ÙŠÙ‚Ø©</h3>
                    <p>Ù‚ÙˆØ§Ø¦Ù… Ø§Ù†ÙŠÙ‚Ø© ÙˆØªØµÙ†ÙŠÙ ÙˆØ§Ø¶Ø­ Ù„Ù„Ø­Ù„Ù‚Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ³Ù….</p>
                </article>
                <article class="feature">
                    <div class="icon">âš¡</div>
                    <h3>Ø£Ø¯Ø§Ø¡ Ø³Ø±ÙŠØ¹</h3>
                    <p>ØªÙ… ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙŠØ¹Ù…Ù„ Ø¨Ø®ÙØ© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ø¬Ù‡Ø²Ø© Ø§Ù„Ø§Ù†Ø¯Ø±ÙˆÙŠØ¯.</p>
                </article>
                <article class="feature">
                    <div class="icon">ğŸ””</div>
                    <h3>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                    <p>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ù†Ø¯ ØµØ¯ÙˆØ± Ø­Ù„Ù‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©.</p>
                </article>
                <article class="feature">
                    <div class="icon">ğŸ’¬</div>
                    <h3>ØªÙˆØ§ØµÙ„</h3>
                    <p>Ø§Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø­Ø¨ÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø§ÙˆØªØ§ÙƒÙˆ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
                </article>
            </div>
        </section>

        <section class="container screenshots" aria-labelledby="screens-title">
            <h2 id="screens-title">Ø¨Ø¹Ø¶ Ø§Ù„Ø§Ù†Ù…ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©</h2>
            <div class="screens-grid">
                <img src="screen1.jpg" alt="Ø§Ù„Ø§Ù†Ù…ÙŠ 1" loading="lazy" />
                <img src="screen2.jpg" alt="Ø§Ù„Ø§Ù†Ù…ÙŠ 2" loading="lazy" />
                <img src="screen3.jpg" alt="Ø§Ù„Ø§Ù†Ù…ÙŠ 3" loading="lazy" />
            </div>
        </section>

        <section class="container cta-band" aria-labelledby="cta-title">
            <h3 id="cta-title" class="visually-hidden">Ø¯Ø¹ÙˆØ© Ù„Ù„ØªØ­Ù…ÙŠÙ„</h3>
                    <div class="cta-inner">
                    <div>
                        <h3>Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŸ</h3>
                        <p>Ø­Ù…Ù‘Ù„ ANIME DIIB Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø³Ù„Ø³Ù„Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©.</p>
                    </div>
                    <div style="display:flex;gap:12px;align-items:center">
                        <button id="download-cta" class="btn btn-primary" data-href="https://1drv.ms/u/c/846dc043d4c4fd3b/IQDAFJufykDESbGP7xjBJNlnAXlzYCYA_Za3UUjS6Clcf7A">ØªØ­Ù…ÙŠÙ„</button>
                        <a class="btn btn-outline" href="#features">Ø§Ù„Ù…Ø²Ø§ÙŠØ§</a>
                    </div>
                </div>
        </section>
    </main>

    <footer class="site-footer" role="contentinfo">
        <div class="container footer-inner">
            <div class="footer-left">Â© <span id="year"></span> <span class="gradient-text footer-brand">ANIME DIIB</span></div>
            <div class="footer-right">
                <nav class="footer-links" aria-label="Ø±ÙˆØ§Ø¨Ø· ØªÙƒÙ…ÙŠÙ„ÙŠØ©">
                    <a href="contact.html">ØªÙˆØ§ØµÙ„</a>
                    <a href="privacy.html">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                </nav>
                <div class="footer-note">Ø¥ØµØ¯Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø§Ø³ØªØ¨Ø¯Ù„ Ù…Ù„Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ØªÙˆÙØ±Ù‡Ø§</div>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
    </script>
        <script>
            // Download with progress (fetch stream) and trigger browser download
            (function(){
                async function downloadWithProgress(url, onProgress){
                    const resp = await fetch(url);
                    if(!resp.ok) throw new Error('Network response was not ok');
                    const contentLength = resp.headers.get('Content-Length') || resp.headers.get('content-length');
                    const total = contentLength ? parseInt(contentLength,10) : null;
                    const reader = resp.body.getReader();
                    const chunks = [];
                    let received = 0;

                    while(true){
                        const {done, value} = await reader.read();
                        if(done) break;
                        chunks.push(value);
                        received += value.length;
                        if(total && onProgress) onProgress(received / total);
                        else if(onProgress) onProgress(null);
                    }

                    // build blob
                    const blob = new Blob(chunks, {type: resp.headers.get('Content-Type') || 'application/octet-stream'});
                    return blob;
                }

                function startDownload(url, progressEl){
                    const isAndroid = /Android/i.test(navigator.userAgent || navigator.platform);

                    // If the URL is hosted on known direct-download providers (Google Drive, Dropbox, etc.)
                    // prefer direct navigation so the browser handles the download immediately.
                    try{
                        const directHosts = ['drive.google.com','dropbox.com','dl.dropboxusercontent.com','googleusercontent.com'];
                        const isDirectHost = directHosts.some(h => url.includes(h));
                        const hasExportParam = /export=download/i.test(url);
                        if(isDirectHost || hasExportParam){
                            const hdr = document.getElementById('header-download-progress');
                            const main = document.getElementById('download-progress');
                            const targets = [progressEl, hdr, main].filter(Boolean);
                            targets.forEach(t=>{ t.classList.remove('visually-hidden'); t.setAttribute('aria-hidden','false'); const lbl = t.querySelector('.progress-label, .header-progress-label'); if(lbl) lbl.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'; });
                            // Start browser download/navigation immediately
                            window.location.assign(url);
                            return;
                        }
                    }catch(e){ console.warn('Direct-host detection failed, continuing to programmatic download', e); }

                    // If this is an APK and we're on Android, prefer letting the browser handle the download
                    // directly (avoids blob URL issues that can block installation on some Android browsers).
                    if(isAndroid && /\.apk($|\?)/i.test(url)){
                        // show small feedback in progress elements
                        const hdr = document.getElementById('header-download-progress');
                        const main = document.getElementById('download-progress');
                        const targets = [progressEl, hdr, main].filter(Boolean);
                        targets.forEach(t=>{ t.classList.remove('visually-hidden'); t.setAttribute('aria-hidden','false'); const lbl = t.querySelector('.progress-label, .header-progress-label'); if(lbl) lbl.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'; });
                        try{
                            // Use location.assign to start the browser download flow
                            window.location.assign(url);
                        }catch(e){
                            console.error('Direct navigation failed, falling back to programmatic download', e);
                            // fallback to programmatic fetch-based download
                        }
                        return;
                    }

                    // collect all progress elements we want to sync
                    const hdr = document.getElementById('header-download-progress');
                    const main = document.getElementById('download-progress');
                    const targets = [];
                    if(progressEl) targets.push(progressEl);
                    if(hdr && targets.indexOf(hdr) === -1) targets.push(hdr);
                    if(main && targets.indexOf(main) === -1) targets.push(main);

                    // Prepare UI for each target
                    const ui = targets.map(t=>{
                        const bar = t.querySelector('.progress-bar') || t.querySelector('.header-progress-bar');
                        const label = t.querySelector('.progress-label') || t.querySelector('.header-progress-label');
                        t.classList.remove('visually-hidden');
                        t.setAttribute('aria-hidden','false');
                        if(label) label.textContent = '0%';
                        if(bar) { bar.style.width = '0%'; bar.classList.remove('indeterminate'); bar.setAttribute('aria-valuenow','0'); }
                        return {wrap: t, bar, label};
                    });

                    let lastPct = 0;

                    downloadWithProgress(url, (ratio)=>{
                        if(ratio === null){
                            // unknown size: show indeterminate animation
                            ui.forEach(u=>{
                                if(u.label) u.label.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
                                if(u.bar) u.bar.classList.add('indeterminate');
                            });
                        } else {
                            const pct = Math.floor(ratio * 100);
                            // only update when changed to reduce layout thrash
                            if(pct !== lastPct){
                                lastPct = pct;
                                ui.forEach(u=>{
                                    if(u.bar){ u.bar.classList.remove('indeterminate'); u.bar.style.width = pct + '%'; u.bar.setAttribute('aria-valuenow', String(pct)); }
                                    if(u.label) u.label.textContent = pct + '%';
                                });
                            }
                        }
                    }).then(blob=>{
                        // trigger download
                        const a = document.createElement('a');
                        const u = URL.createObjectURL(blob);
                        a.href = u;
                        a.download = url.split('/').pop();
                        document.body.appendChild(a);
                        a.click();
                        a.remove();
                        URL.revokeObjectURL(u);
                        // hide progress after short delay
                        setTimeout(()=>{
                            ui.forEach(u=>{
                                u.wrap.classList.add('visually-hidden');
                                u.wrap.setAttribute('aria-hidden','true');
                                if(u.bar){ u.bar.style.width='0%'; u.bar.setAttribute('aria-valuenow','0'); }
                                if(u.label) u.label.textContent = '0%';
                            });
                        },1400);
                    }).catch(err=>{
                        // better error UX than alert
                        try{ ui.forEach(u=>{ if(u.label) u.label.textContent = 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„'; }); }catch(e){}
                        console.error('Download error', err);
                        ui.forEach(u=>{ u.wrap.classList.add('visually-hidden'); u.wrap.setAttribute('aria-hidden','true'); });
                    });
                }

                // expose startDownload for other scripts (modal, header button)
                window.downloadWithProgress = downloadWithProgress;
                window.startDownload = startDownload;

                // wire buttons that have a data-href attribute (header, CTAs)
                const progressWrap = document.getElementById('download-progress');
                const headerProgress = document.getElementById('header-download-progress');
                const downloadEls = document.querySelectorAll('[data-href]');
                downloadEls.forEach(btn=>{
                    if(!btn) return;
                    btn.addEventListener('click', (e)=>{
                        e.preventDefault();
                        const url = btn.dataset.href || btn.getAttribute('data-href') || btn.getAttribute('href');
                        if(!url) return alert('Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');

                        // Prefer explicit data-progress-target, else choose header progress for header, else main progress
                        let progressEl = null;
                        if(btn.dataset.progressTarget){
                            progressEl = document.querySelector(btn.dataset.progressTarget);
                        } else if(btn.id === 'download-nav' || btn.closest('.site-header')){
                            progressEl = headerProgress || progressWrap;
                        } else {
                            progressEl = progressWrap;
                        }

                        startDownload(url, progressEl);
                    });
                });
            })();
        </script>

        <script>
                // Rating widget (uses the static `#rating-block` in the hero)
            (function(){
                const key = 'anime-diib-rating';
                const userKey = 'anime-diib-user-rating';

                function readStore(){ try{ return JSON.parse(localStorage.getItem(key)) || {sum:0,count:0}; } catch(e){ return {sum:0,count:0}; } }
                function writeStore(v){ localStorage.setItem(key, JSON.stringify(v)); }
                function readUser(){ return parseInt(localStorage.getItem(userKey),10) || 0; }
                function writeUser(v){ localStorage.setItem(userKey, String(v)); }

                const block = document.getElementById('rating-block');
                if(!block) return;
                const avgEl = block.querySelector('#rating-average');
                const starsText = block.querySelector('#rating-stars');
                const inputWrap = block.querySelector('#rating-input');
                const countEl = block.querySelector('#rating-count');

                // header display elements (may be absent on very small screens)
                const hdrAvg = document.getElementById('hdr-rating-average');
                const hdrStars = document.getElementById('hdr-rating-stars');

                function render(){
                    const store = readStore();
                    const avg = store.count ? (store.sum / store.count) : 0;
                    const avgText = store.count ? (Math.round(avg*10)/10) : '0.0';
                    avgEl.textContent = avgText;
                    // update header if present
                    if(hdrAvg) hdrAvg.textContent = avgText;

                    // stars textual display (rounded)
                    const rounded = Math.round(avg);
                    const stars = Array.from({length:5}).map((_,i)=> i < rounded ? 'â˜…' : 'â˜†').join('');
                    starsText.textContent = stars;
                    if(hdrStars) hdrStars.textContent = stars;

                    countEl.textContent = store.count ? (store.count + ' ØªÙ‚ÙŠÙŠÙ…') : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¹Ø¯';
                    // mark user selection
                    const user = readUser();
                    const btns = inputWrap.querySelectorAll('.star-btn');
                    btns.forEach(b=>{ const v = parseInt(b.dataset.value,10); b.textContent = (user && v <= user) ? 'â˜…' : 'â˜†'; });
                }

                inputWrap.addEventListener('click', (e)=>{
                    const btn = e.target.closest('.star-btn');
                    if(!btn) return;
                    const v = parseInt(btn.dataset.value,10);
                    const store = readStore();
                    const prev = readUser();

                    if(prev && prev > 0){
                        // user is updating their previous rating: adjust sum but do not change count
                        store.sum = Math.max(0, (store.sum - prev) + v);
                        // feedback briefly
                        countEl.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙ‚ÙŠÙŠÙ…Ùƒ â€” ' + (store.count ? (store.count + ' ØªÙ‚ÙŠÙŠÙ…') : '');
                    } else {
                        // new rating
                        store.sum += v;
                        store.count += 1;
                        countEl.textContent = store.count + ' ØªÙ‚ÙŠÙŠÙ…';
                    }

                    writeStore(store);
                    writeUser(v);
                    render();
                });

                // initial render
                render();
            })();
        </script>
        <script>
            (function(){
                const isAndroid = /Android/i.test(navigator.userAgent || navigator.platform);
                const downloadEls = document.querySelectorAll('[data-href$=".apk"], a[href$=".apk"], a.android-only');
                const pwaBtn = document.getElementById('pwa-install');
                const notAndroidEl = document.getElementById('not-android');

                // register service worker for PWA
                if('serviceWorker' in navigator){
                    navigator.serviceWorker.register('sw.js').catch(()=>{});
                }

                // Intercept APK downloads: if not Android, show a friendly notice asking user to open on Android
                downloadEls.forEach(el=>{
                    el.addEventListener('click', (ev)=>{
                        const href = el.dataset && el.dataset.href ? el.dataset.href : el.getAttribute('href');
                        if(!isAndroid){
                            ev.preventDefault();
                            if(notAndroidEl){
                                notAndroidEl.classList.remove('visually-hidden');
                                notAndroidEl.setAttribute('aria-hidden','false');
                                notAndroidEl.scrollIntoView({behavior:'smooth', block:'center'});
                            } else {
                                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.');
                            }
                        }
                    });
                });

                // PWA install handling: show install prompt on Android; otherwise show notice
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e)=>{
                    e.preventDefault();
                    deferredPrompt = e;
                    if(pwaBtn){
                        pwaBtn.classList.remove('visually-hidden');
                        pwaBtn.setAttribute('aria-hidden','false');
                        pwaBtn.addEventListener('click', async (ev)=>{
                            if(!isAndroid){
                                ev.preventDefault();
                                if(notAndroidEl){ notAndroidEl.classList.remove('visually-hidden'); notAndroidEl.setAttribute('aria-hidden','false'); }
                                return;
                            }
                            if(!deferredPrompt) return;
                            pwaBtn.setAttribute('disabled','true');
                            deferredPrompt.prompt();
                            await deferredPrompt.userChoice;
                            deferredPrompt = null;
                            pwaBtn.removeAttribute('disabled');
                        });
                    }
                });
            })();
        </script>
        <script>
            (function(){
                const sendBtn = document.getElementById('send-link');
                const modal = document.getElementById('sendlink-modal');
                const mailto = document.getElementById('mailto-link');
                const showQr = document.getElementById('show-qr');
                const qrImg = document.getElementById('qr-img');
                const qrContainer = document.getElementById('qr-container');
                const copyBtn = document.getElementById('copy-link');
                const closeBtn = document.getElementById('sendlink-close');

                function getDownloadUrl(){
                    return 'https://drive.google.com/uc?export=download&id=13PApSNTBzQoWTvaN3M87yrkBo9n9UTU9';
                }

                if(sendBtn){
                    sendBtn.addEventListener('click', ()=>{
                        modal.classList.remove('visually-hidden');
                        modal.setAttribute('aria-hidden','false');
                    });
                }

                if(mailto){
                    mailto.addEventListener('click', (e)=>{
                        const url = getDownloadUrl();
                        const subject = encodeURIComponent('Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ ANIME DIIB');
                        const body = encodeURIComponent('Ù…Ø±Ø­Ø¨Ø§Ù‹,%0D%0AØ¥Ù„ÙŠÙƒ Ø±Ø§Ø¨Ø· ØªÙ†Ø²ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ ANIME DIIB:%0D%0A' + url + '%0D%0A%0D%0AØªØ­ÙŠØ§ØªÙŠ');
                        mailto.href = `mailto:?subject=${subject}&body=${body}`;
                    });
                }

                if(showQr){
                    showQr.addEventListener('click', ()=>{
                        const url = getDownloadUrl();
                        // use public QR generator
                        qrImg.src = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodeURIComponent(url);
                        qrContainer.style.display = 'block';
                    });
                }

                if(copyBtn){
                    copyBtn.addEventListener('click', async ()=>{
                        const url = getDownloadUrl();
                        try{ await navigator.clipboard.writeText(url); copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø®'; setTimeout(()=>copyBtn.textContent='Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·',2000);}catch(e){alert('Ù†Ø³Ø® ÙØ´Ù„ â€” Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹: ' + url)}
                    });
                }

                if(closeBtn){ closeBtn.addEventListener('click', ()=>{ modal.classList.add('visually-hidden'); modal.setAttribute('aria-hidden','true'); qrContainer.style.display='none'; }); }
            })();
        </script>
    </body>
</html>
